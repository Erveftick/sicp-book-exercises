(ns ^{:doc          "–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–±—Ä–∞–Ω—ã —Ä–µ—à–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏–∑ –∫–Ω–∏–≥–∏
                     'Structure and Interpretation Computer Programs'
                     '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º'

                     https://newstar.rinet.ru/~goga/sicp/sicp.pdf

                     –†–∞–∑–¥–µ–ª 2"
      :author       "Edward Kvashyn"
      :date-created "2022-09-07"
      :date-ended   "..."}
  sicp-book-exercises.chapter-2
  (:gen-class)
  (:require [sicp-book-exercises.chapter-1 :as ch-1]
            ))

;;;; 2.1

(defn numer [x]
  (first x))

(defn denom [x]
  (comment
   "–í –∫–Ω–∏–≥–µ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∞ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é cdr,
   –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–æ–º —Ñ—É–Ω–∫—Ü–∏–∏ rest –≤ Clojure.
   https://www.gnu.org/software/emacs/manual/html_node/eintr/car-_0026-cdr.html#:~:text=Clearly%2C%20a%20more%20reasonable%20name%20for%20cdr%20would%20be%20rest

   –ù–æ –≤ Clojure –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–º–Ω–æ–∂–∏—Ç—å —Å–ø–∏—Å–∫–∏, –ø–æ—ç—Ç–æ–º—É
   —è –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é second, —á—Ç–æ–±—ã –≤–∑—è—Ç—å
   –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —á–∏—Å–ª–æ, –∞ –Ω–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ")
  (second x)
  )

(defn make-rat [n d]
  (comment
   "–ê–Ω–∞–ª–æ–≥–æ–º cons –∏–∑ scheme —è–≤–ª—è–µ—Ç—Å—è list. –§—É–Ω–∫—Ü–∏—è
   cons –≤ clojure —Ç–æ–∂–µ –µ—Å—Ç—å, –Ω–æ –æ–Ω–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç
   —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞")
  (let [g (ch-1/gcd n d)]
    (list (/ n g) (/ d g))))

(defn mul-rat [x y]
  (make-rat (* (numer x) (numer y))
            (* (denom x) (denom y))))

(comment
 (make-rat 1 -2) ; => (-1 2)
 (make-rat -1 -2) ; => (1 2)
 (make-rat -1 2) ; => (-1 2)
 (mul-rat (make-rat -1 2) (make-rat -1 -3)) ; => (-1 6)
 )

;;;; 2.2

(defn x-point [point]
  (first point))

(defn y-point [point]
  (second point))

(defn make-segment [start-segment end-segment]
  (let [[a b] start-segment
        [c d] end-segment]
    (list (ch-1/average a c) (ch-1/average b d))))

(defn print-point [p]
  (println (str "(" (x-point p) "," (y-point p) ")")))

(comment
 (print-point (make-segment '(-1 3) '(6 5)))
 ; (5/2,4)
 ; => nil
 )

;;;; 2.3

(defn calc-side
  "–°—á–∏—Ç–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ñ–æ—Ä–º—É–ª–µ"
  [x1 x2 y1 y2]
  (Math/sqrt (+ (Math/pow (- x2 x1) 2) (Math/pow (- y2 y1) 2)))
  )

(defn rect-sides
  "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞,
  –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ —à–∏—Ä–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É

  –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–µ–∫ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã
  –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:
  a----b
  |    |
  d----c"
  [a b c & d]
  (let [[x1 y1] a
        [x2 y2] b
        [x3 y3] c
        width  (calc-side x1 x2 y1 y2)
        height (calc-side x2 x3 y3 y2)]
    (list height width)))

(defn rect-square
  "–û–±—â–∞—è —Ñ–æ—Ä–º—É–ª–∞, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–æ—â–∞–¥—å –∏
  –ø–µ—Ä–∏–º–µ—Ç—Ä –ø–æ –ø–æ–¥–∞–Ω–Ω—ã–º –≤ —Ñ—É–Ω–∫—Ü–∏—é —Å–ø–∏—Å–∫—É –∏–∑
  –≤—ã—Å–æ—Ç—ã –∏ —à–∏—Ä–∏–Ω—ã"
  [rect]
  (let [[height width] rect
        S (* height width)
        P (* 2 (+ height width))]
    {:square    S
     :perimeter P}))

(comment
 "–°–Ω–∞—á–∞–ª–∞ —è —Å–¥–µ–ª–∞–ª —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞–µ—Ç
 –ø–ª–æ—â–∞–¥—å –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä, –∫–æ–≥–¥–∞ –≤ –Ω–µ–µ –ø–æ–¥–∞–ª —Å–ø–∏—Å–æ–∫ —Å
 –¥–∞–Ω–Ω—ã–º–∏ –æ –≤—ã—Å–æ—Ç–µ –∏ —à–∏—Ä–∏–Ω–µ. –ü–æ—Ç–æ–º —Å–¥–µ–ª–∞–ª —Ñ—É–Ω–∫—Ü–∏—é,
 –∫–æ—Ç–æ—Ä–∞—è —Å—á–∏—Ç–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ –ø–æ –ø–æ–¥–∞–Ω–Ω—ã–º
 —á–µ—Ç—ã—Ä—ë–º —Ç–æ—á–∫–∞–º. –í –∏—Ç–æ–≥–µ –≤—Å—ë —Å–≤—ë–ª –∫ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏,
 –∫–∞–∫ –∏ –ø—Ä–æ—Å–∏–ª–æ—Å—å"
 (rect-square '(3 5)) ; => {:square 15, :perimeter 16}
 (rect-square (rect-sides '(0 0) '(0 2) '(2 2) '(2 0))) ; => {:square 4.0, :perimeter 8.0}
 )

;;;; 2.4

(comment
 ;; –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 2.4.
 ;; –í–æ—Ç –µ—â–µ –æ–¥–Ω–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —á—Ç–æ –ø—Ä–∏
 ;; –ª—é–±—ã—Ö –¥–≤—É—Ö –æ–±—ä–µ–∫—Ç–∞—Ö x –∏ y (car (cons x y)) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç x.

 "Translator:

  | Common Lisp | Clojure |
  -------------------------
  | car         | first   |
  | cons        | cons    |
  | cdr         | rest    |"
 )

(defn cons-2-4 [x y]
  (fn [m] (m x y)))

(defn car-2-4 [z]
  (z (fn [p q] p)))

;; –ï—Å–ª–∏ car, —ç—Ç–æ first, —Ç–æ –ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—Å—ë, –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ, —Ç–æ–≥–¥–∞

(defn cdr-2-4 [z]
  (z (fn [_ more] more)))

(comment
 (car-2-4 (cons-2-4 "1" "2"))
 (cdr-2-4 (cons-2-4 "1" (list "2" "3" "4"))))

;; –•–æ—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –∏ –æ–∫–∞–∑–∞–ª–æ—Å—å –ø—Ä–æ—Å—Ç—ã–º, –Ω–æ –æ—á–µ–Ω—å —Å—Ç—Ä–∞–Ω–Ω–æ–µ

;;;; 2.5

;–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 2.5.
;–ü–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ø–∞—Ä—ã –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞
;–∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ø–∞—Ä—É a –∏ b –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ 2a 3b . –î–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç-
;—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä cons, car –∏ cdr.

(defn task-2-5 [a b]
  (* (ch-1/fast-expt 2 a) (ch-1/fast-expt 3 b)))

(comment
 (task-2-5 4 5)
 )

; TODO: –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –∑–∞–¥–∞–Ω–∏—é, –∏ –ø–æ–Ω—è—Ç—å, –∑–∞—á–µ–º –∏–º cons –∏ —Ç–¥

;;;; 2.6

(def zero (fn [f] (fn [x] x)))

(defn add-1 [n]
  (fn [f] (fn [x] (f ((n f) x)))))

(def one (fn [f] (fn [x] (f x))))
(def two (fn [f] (fn [x] (f (f x)))))

(defn plus [a b]
  (fn [f]
    (fn [x]
      ((a f) ((b f) x)))))

(comment
 ((zero inc) 0) ; => 0
 ((one inc) 0) ; => 1
 (((add-1 one) inc) 0) ; => 2
 ((two inc) 0) ; => 2
 (((plus two one) inc) 0) ; => 3
 ; –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ. –ù–æ –¥–µ–ª–∞—Ç—å –µ–≥–æ –±—ã–ª–æ –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ...ü§Æ
 )
